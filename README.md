# Multi-Model Redis

This is a demo built for RedisConf18 keynote and shows how how Redis can be used as a multi-model database using Search ([RediSearch](https://oss.redislabs.com/redisearch/)), Streams, and Graph ([Redis Graph](https://oss.redislabs.com/redisgraph/)).

## Topology

Due to this being a technology demo, many things were in alpha and beta states at time of demo. To combat any stability or conflicts, I used three instances of Redis: Redis Unstable (providing Streams), Redis Stable + RediSearch, and Redis Stable + Redis Graph. There is no reason why you couldn't use one instance of Redis 5.x with RediSearch and Redis Graph, but the scripts are built to accommodate connections to multiple Redis instances.

The demo uses multiple small Node.js scripts to manage each feature of the demo (microservices-ish). The first one is the Twitter eater which takes a high volume Twitter application API stream and adds each tweet to a Redis stream. The word frequency counter, search indexer and graph indexer all consume this stream. Note that Twitter eater relies on a module that doesn't seem to detect dead stream connections well, so, for example, closing your laptop might create a dead stream that doesn't throw an error.

The search and graph query features are controlled by streams as well, so user queries are ultimately converted into streams that are consumed and the results are pushed back on another stream.

The web server (server.node.js) is an Express app that has been extended to handle websockets. This consumes the streams created by feature microservices then "proxies" those results back out to a websocket (and thus to the browser). The search and graph features use websockets to communicate back with the server process and then those are also converted into streams.

Finally, there is a stream-powered control plane that activates and deactivates particular microservices. When service is clicked in the stream control panel it toggles the service by firing off a stream item. This works well, but isn't fool proof as it doesn't actually _detect_ stream activity - so restarts of a service may show incorrectly in the panel.

_Note on Redis Graph_: The hexastore implementation that is currently publicly avaliable is not production ready and will struggle under large volumes of data that can be easily generated by this demo. The GraphBLAS implementation (in development) largely solves this issue, allow for large datasets in an efficient manner.

## Setup

To setup the demo, you will need Node.js, NPM, Bower and your (at least one) Redis connection information. 

First, install the server-side Node modules with NPM
```
$ npm install
```

Next, you'll need to install the client-side components:
```
$ bower install
```

Your connection information should be in JSON files as per a [node_redis connection object](https://github.com/NodeRedis/node_redis#rediscreateclient). You will also need your Twitter credentials from the twitter developer API in JSON

You can start the processes via some sort of process manager (PM2, etc) or in multiple terminals (or, indeed, multiple machines).

The webserver:
```
$  node server.node.js --connection /path/to/json/with/info/about/redis/with/streams.json
```

The graph engine:
```
$ node engine.graph.node.js --streamconnection /path/to/json/with/info/about/redis/with/streams.json --graphconnection /path/to/json/with/info/about/redis/with/graph.json
```

The Twitter eater, the `terms` argument is the keyword on which the demo will run - it works best with something high volume (politics, sports, etc).
```
$ node twitter.eater.js --connection /path/to/json/with/info/about/redis/with/streams.json  --twittercreds /path/to/json/with/twitter/credentials.json  --terms foobar
```

The word cloud generator:
```
node engine.word.cloud.node.js --connection /path/to/json/with/info/about/redis/with/streams.json 
```

The search engine:
```
$ node engine.search.node.js --searchconnection /path/to/json/with/info/about/redis/with/search.json --streamconnection /path/to/json/with/info/about/redis/with/streams.json 
```


The service will launch on localhost:4000


## License

Copyright 2018 Kyle Davis

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
